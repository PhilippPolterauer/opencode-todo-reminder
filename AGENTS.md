# AGENTS.md

This repository is a small TypeScript plugin for OpenCode. Use this file as the
single source of truth for build/lint/test commands and house style.

## Quick facts
- Runtime: Node.js (ESM)
- Language: TypeScript
- Entry points: src/index.ts, src/plugin.ts, src/config.ts
- Output: dist/ (generated by TypeScript)
- Config file: .opencode/todo-reminder.json (project) or ~/.config/opencode/todo-reminder.json (global)

## Build, lint, and test commands

### Install
- `npm install`

### Build
- `npm run build` (runs `tsc`, writes to `dist/`)

### Typecheck
- `npm run typecheck` (runs `tsc --noEmit`)

### Lint
- No lint script configured.
- If you add a linter, update this section and document any config files.
- Do not add lint-only dependencies without a clear justification.

### Tests
- No test runner or test scripts configured.
- No single-test command available.
- If you add tests, document:
  - How to run all tests.
  - How to run a single test file.
  - How to run a single test case by name.

## Code style and conventions

### TypeScript and modules
- Use ESM imports/exports (this repo is `type: "module"`).
- Use explicit file extensions for local ESM imports (e.g., `./plugin.js`).
- Prefer `type`-only imports when importing types (`import { type Foo } from "..."`).
- Keep TypeScript `strict` mode compatible (see `tsconfig.json`).
- Keep exports minimal and explicit; avoid large barrel re-exports.

### Formatting
- Match existing formatting in `src/`:
  - 4-space indentation.
  - Double quotes, not single quotes.
  - Keep line length reasonable; wrap long chains or objects.
- Avoid introducing non-ASCII characters unless the file already uses them.

### Naming
- Use `camelCase` for variables and functions.
- Use `PascalCase` for exported types and classes.
- Use `UPPER_SNAKE_CASE` for module-level constants.
- Be explicit in names; avoid single-letter variables outside small loops.
- Keep booleans affirmative (`isEnabled`, `hasTodos`).

### Imports and file layout
- Group imports by source: node built-ins, external deps, then local files.
- Keep local imports relative and explicit.
- Avoid unused imports; remove or inline as needed.
- Prefer one export per file for primary concepts.
- Keep small helpers near usage; shared utilities belong in `src/`.

### Types and interfaces
- Prefer `interface` for public shapes and config types.
- Use `type` aliases for unions and complex compositions.
- Avoid `any`; use `unknown` and narrow where needed.
- Use `Required<T>` when merging defaults with optional user config.
- Avoid implicit `any` in callbacks; type parameters explicitly when needed.

### Error handling and logging
- Fail soft in plugin hooks to avoid user disruption.
- Prefer targeted `try/catch` around I/O or API calls.
- Log unexpected errors with context, but avoid noisy output.
- Do not throw in event hooks unless needed to stop unsafe behavior.
- Swallow errors from UI helpers (toast, prompts) to preserve UX.

### Control flow and guards
- Use early returns for guard clauses.
- Validate external data and confirm array/object shapes before use.
- Avoid deep nesting where simple guards suffice.
- Prefer small, focused functions over long multi-branch blocks.

### Async patterns
- Prefer `async/await` over promise chains.
- Keep async functions small and focused.
- Avoid fire-and-forget unless explicitly intended and safe.
- Ensure awaited calls that touch the UI are inside `try/catch` when needed.

### Data handling
- Treat external inputs as untrusted.
- Escape or sanitize text that will be embedded in XML/markup.
- Avoid mutating shared state without clear intent.
- Keep config defaults centralized and immutable.

### Comments
- Add short comments only when the code is non-obvious.
- Avoid restating what the code already makes clear.
- Use comments to explain guard rationale or tricky edge cases.

## Repository-specific behavior
- Plugin must not interrupt the user flow when reminders fail.
- Reminders should be idempotent; avoid infinite loops.
- Keep config defaults centralized in `src/config.ts`.
- Avoid changes in `dist/` manually; rely on `tsc` output.

## Project structure
- `src/index.ts`: module exports.
- `src/plugin.ts`: plugin implementation.
- `src/config.ts`: config loading and defaults.
- `dist/`: build output (generated).

## Cursor/Copilot rules
- No `.cursorrules` or `.cursor/rules/` found.
- No `.github/copilot-instructions.md` found.
- If you add such rules, summarize them here.

## Agent workflow guidance
- Read existing files before editing.
- Minimize scope of changes; be surgical.
- Update docs only when explicitly requested.
- Avoid touching `dist/` manually; rely on `tsc` output.
- Do not change versioning unless explicitly requested.

## When adding tests (future)
- Document the test framework (e.g., Vitest, Jest).
- Provide a single-test command by file and by test name.
- Update this file with any required environment variables.
- Keep tests fast and deterministic.

## When adding linting (future)
- Document `npm run lint` and any autofix command.
- Note required editor settings or formatter integrations.

## Versioning and releases
- The package version lives in `package.json`.
- Do not change versioning unless explicitly requested.
- Do not publish from CI unless explicitly configured.

## Notes for agents
- Keep compatibility with Node ESM and `tsconfig` settings.
- Respect user configuration overrides in `.opencode/todo-reminder.json`.
- Use minimal new dependencies; justify each addition.
